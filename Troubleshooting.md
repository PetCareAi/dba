# üîß Guia de Resolu√ß√£o de Problemas - PetCare DBA Admin

Este guia cont√©m solu√ß√µes para problemas comuns encontrados no PetCare DBA Admin.

## üìã √çndice

1. [Problemas de Instala√ß√£o](#problemas-de-instala√ß√£o)
2. [Problemas de Conex√£o com Banco](#problemas-de-conex√£o-com-banco)
3. [Problemas de Autentica√ß√£o](#problemas-de-autentica√ß√£o)
4. [Problemas de Interface](#problemas-de-interface)
5. [Problemas de Performance](#problemas-de-performance)
6. [Problemas com Supabase](#problemas-com-supabase)
7. [Problemas com Projetos/Scripts](#problemas-com-projetosscripts)
8. [Diagn√≥stico Geral](#diagn√≥stico-geral)

---

## üö® Problemas de Instala√ß√£o

### ‚ùå Erro: "ModuleNotFoundError: No module named 'streamlit'"

**Sintomas:**
```
ModuleNotFoundError: No module named 'streamlit'
```

**Solu√ß√µes:**
1. **Instalar depend√™ncias:**
   ```bash
   pip install -r requirements.txt
   ```

2. **Verificar ambiente virtual:**
   ```bash
   # Criar ambiente virtual
   python -m venv venv
   
   # Ativar (Windows)
   venv\Scripts\activate
   
   # Ativar (Linux/Mac)
   source venv/bin/activate
   
   # Instalar depend√™ncias
   pip install -r requirements.txt
   ```

3. **Verificar vers√£o do Python:**
   ```bash
   python --version  # Deve ser 3.9+
   ```

### ‚ùå Erro: "No module named 'supabase'"

**Sintomas:**
```
ImportError: No module named 'supabase'
```

**Solu√ß√µes:**
1. **Instalar Supabase:**
   ```bash
   pip install supabase>=2.0.0
   ```

2. **Atualizar pip:**
   ```bash
   python -m pip install --upgrade pip
   pip install supabase
   ```

### ‚ùå Erro de Depend√™ncias do psycopg2

**Sintomas:**
```
Error: Microsoft Visual C++ 14.0 is required
```

**Solu√ß√µes:**
1. **Usar vers√£o bin√°ria:**
   ```bash
   pip install psycopg2-binary
   ```

2. **No Ubuntu/Debian:**
   ```bash
   sudo apt-get install python3-dev libpq-dev
   pip install psycopg2
   ```

---

## üóÑÔ∏è Problemas de Conex√£o com Banco

### ‚ùå Erro: "Conex√£o com Supabase falhou"

**Sintomas:**
- Modo demo ativado automaticamente
- Mensagem "‚ùå Erro ao conectar com Supabase"

**Solu√ß√µes:**

1. **Verificar credenciais no .streamlit/secrets.toml:**
   ```toml
   [supabase]
   url = "https://seu-projeto.supabase.co"
   anon_key = "sua_chave_anonima"
   service_key = "sua_chave_service"
   ```

2. **Testar conex√£o manualmente:**
   ```python
   from supabase import create_client
   
   url = "sua_url"
   key = "sua_chave"
   supabase = create_client(url, key)
   
   # Teste simples
   response = supabase.table('projetos_analytics').select('id').limit(1).execute()
   print(response)
   ```

3. **Verificar URL do Supabase:**
   - Deve come√ßar com `https://`
   - Deve terminar com `.supabase.co`
   - N√£o deve conter espa√ßos ou caracteres especiais

### ‚ùå Erro: "Row Level Security"

**Sintomas:**
```
permission denied for table projetos_analytics
```

**Solu√ß√µes:**

1. **Executar script de corre√ß√£o RLS:**
   ```sql
   -- Op√ß√£o 1: Desabilitar RLS temporariamente
   ALTER TABLE projetos_analytics DISABLE ROW LEVEL SECURITY;
   ALTER TABLE scripts_projetos DISABLE ROW LEVEL SECURITY;
   ALTER TABLE execucoes_scripts DISABLE ROW LEVEL SECURITY;
   
   -- Op√ß√£o 2: Criar pol√≠ticas para service_role
   CREATE POLICY "service_role_all_access" ON projetos_analytics
   FOR ALL TO service_role
   USING (true)
   WITH CHECK (true);
   ```

2. **Verificar chave service_role:**
   - Use a chave `service_role` e n√£o `anon`
   - Verifique se a chave n√£o expirou

### ‚ùå Tabelas n√£o encontradas

**Sintomas:**
- "üì≠ Nenhuma tabela encontrada"
- Lista de tabelas vazia

**Solu√ß√µes:**

1. **Executar scripts de cria√ß√£o:**
   ```bash
   # Execute os SQLs do diret√≥rio database/
   psql -f database/supabase-projects-table.sql
   psql -f database/supabase-conversas-ia.sql
   ```

2. **Criar tabelas manualmente no Supabase:**
   - V√° para SQL Editor no painel Supabase
   - Execute os scripts em `database/`

3. **Verificar permiss√µes de schema:**
   ```sql
   -- Verificar tabelas existentes
   SELECT table_name FROM information_schema.tables 
   WHERE table_schema = 'public';
   ```

---

## üîê Problemas de Autentica√ß√£o

### ‚ùå Login n√£o funciona

**Sintomas:**
- "‚ùå Usu√°rio ou senha incorretos!"
- P√°gina de login n√£o avan√ßa

**Solu√ß√µes:**

1. **Credenciais padr√£o:**
   - **Usu√°rio:** `admin`
   - **Senha:** `petcare2025`

2. **Verificar configura√ß√£o:**
   ```toml
   # .streamlit/secrets.toml
   [admin]
   username = "admin"
   password = "petcare2025"
   email = "admin@petcareai.com"
   ```

3. **Limpar cache do navegador:**
   - Ctrl+F5 para recarregar
   - Limpar cookies do localhost

### ‚ùå Sess√£o expira rapidamente

**Sintomas:**
- Redirecionamento constante para login
- Perda de estado da aplica√ß√£o

**Solu√ß√µes:**

1. **Verificar configura√ß√µes de sess√£o:**
   ```python
   # No c√≥digo, ajustar timeout
   session_timeout = 3600  # 1 hora
   ```

2. **Verificar cookies do navegador:**
   - Permitir cookies para localhost
   - Verificar configura√ß√µes de privacidade

---

## üé® Problemas de Interface

### ‚ùå Interface quebrada ou mal formatada

**Sintomas:**
- CSS n√£o carrega corretamente
- Elementos desalinhados
- Cores incorretas

**Solu√ß√µes:**

1. **Limpar cache do Streamlit:**
   ```bash
   streamlit cache clear
   ```

2. **Recarregar p√°gina:**
   - Ctrl+F5 (recarregamento for√ßado)
   - Fechar e reabrir o navegador

3. **Verificar compatibilidade do navegador:**
   - Use Chrome, Firefox ou Edge atualizados
   - Desabilite extens√µes que podem interferir

### ‚ùå Gr√°ficos n√£o aparecem

**Sintomas:**
- Espa√ßos em branco onde deveriam haver gr√°ficos
- Erro com Plotly

**Solu√ß√µes:**

1. **Verificar instala√ß√£o do Plotly:**
   ```bash
   pip install plotly>=5.17.0
   ```

2. **Verificar JavaScript no navegador:**
   - Habilitar JavaScript
   - Desabilitar bloqueadores de script

---

## ‚ö° Problemas de Performance

### ‚ùå Aplica√ß√£o lenta

**Sintomas:**
- Carregamento demorado das p√°ginas
- Timeout em opera√ß√µes

**Solu√ß√µes:**

1. **Otimizar configura√ß√µes:**
   ```toml
   # .streamlit/config.toml
   [server]
   maxUploadSize = 200
   maxMessageSize = 200
   
   [client]
   caching = true
   ```

2. **Reduzir dados exibidos:**
   ```python
   # Limitar registros
   df.head(100)  # Em vez de mostrar todos
   ```

3. **Usar cache:**
   ```python
   @st.cache_data
   def load_data():
       # Sua fun√ß√£o aqui
       pass
   ```

### ‚ùå Alto uso de mem√≥ria

**Sintomas:**
- Sistema lento
- Erro de mem√≥ria

**Solu√ß√µes:**

1. **Limpar cache periodicamente:**
   ```python
   st.cache_data.clear()
   ```

2. **Otimizar DataFrames:**
   ```python
   # Usar tipos de dados eficientes
   df = df.astype({'id': 'int32'})
   ```

---

## üîó Problemas com Supabase

### ‚ùå Erro 401 - Unauthorized

**Sintomas:**
```
{"code":401,"message":"Invalid JWT"}
```

**Solu√ß√µes:**

1. **Verificar chaves:**
   - Use `service_role` key para opera√ß√µes admin
   - Verifique se a chave n√£o expirou

2. **Regenerar chaves:**
   - V√° para Settings > API no painel Supabase
   - Gere novas chaves se necess√°rio

### ‚ùå Erro 403 - Forbidden

**Sintomas:**
```
{"code":403,"message":"Forbidden"}
```

**Solu√ß√µes:**

1. **Verificar RLS policies:**
   ```sql
   -- Ver pol√≠ticas existentes
   SELECT * FROM pg_policies WHERE tablename = 'projetos_analytics';
   ```

2. **Criar pol√≠tica permissiva:**
   ```sql
   CREATE POLICY "allow_all_for_service_role" ON projetos_analytics
   FOR ALL TO service_role
   USING (true)
   WITH CHECK (true);
   ```

### ‚ùå Timeout de conex√£o

**Sintomas:**
- Opera√ß√µes demoram muito
- Erro de timeout

**Solu√ß√µes:**

1. **Verificar regi√£o:**
   - Use regi√£o mais pr√≥xima do usu√°rio
   - Considere migrar projeto se necess√°rio

2. **Otimizar queries:**
   ```sql
   -- Adicionar √≠ndices
   CREATE INDEX idx_nome_coluna ON tabela(coluna);
   ```

---

## üìÅ Problemas com Projetos/Scripts

### ‚ùå N√£o consegue criar projetos

**Sintomas:**
- Erro ao salvar projeto
- "‚ùå Erro ao criar projeto no Supabase"

**Solu√ß√µes:**

1. **Verificar tabelas:**
   ```sql
   -- Verificar se tabela existe
   SELECT EXISTS (
       SELECT FROM information_schema.tables 
       WHERE table_name = 'projetos_analytics'
   );
   ```

2. **Executar script de cria√ß√£o:**
   - Execute `database/supabase-projects-table.sql`

3. **Verificar permiss√µes:**
   ```sql
   -- Dar permiss√µes expl√≠citas
   GRANT ALL ON projetos_analytics TO service_role;
   ```

### ‚ùå Scripts n√£o executam

**Sintomas:**
- "‚ùå Erro na execu√ß√£o"
- Timeout em scripts

**Solu√ß√µes:**

1. **Verificar sintaxe SQL:**
   ```sql
   -- Testar script separadamente
   SELECT 1; -- Script simples para teste
   ```

2. **Verificar permiss√µes de tabelas:**
   ```sql
   -- Verificar se pode acessar tabelas
   SELECT * FROM information_schema.table_privileges 
   WHERE grantee = 'your_role';
   ```

---

## üîç Diagn√≥stico Geral

### üß™ Script de Diagn√≥stico Completo

Execute este script Python para diagnosticar problemas:

```python
import streamlit as st
import sys
import pkg_resources
from datetime import datetime
import os

def diagnostic_check():
    """Executa verifica√ß√£o completa do sistema"""
    
    print("üîç PetCare DBA Admin - Diagn√≥stico Completo")
    print("=" * 50)
    
    # Verificar Python
    print(f"üêç Python: {sys.version}")
    
    # Verificar depend√™ncias
    required_packages = [
        'streamlit', 'supabase', 'pandas', 'plotly', 
        'psycopg2', 'sqlparse', 'numpy', 'requests'
    ]
    
    print("\nüì¶ Depend√™ncias:")
    for package in required_packages:
        try:
            version = pkg_resources.get_distribution(package).version
            print(f"  ‚úÖ {package}: {version}")
        except:
            print(f"  ‚ùå {package}: N√ÉO INSTALADO")
    
    # Verificar arquivos
    print("\nüìÅ Arquivos:")
    required_files = [
        'app.py', 'requirements.txt', '.streamlit/secrets.toml'
    ]
    
    for file in required_files:
        if os.path.exists(file):
            print(f"  ‚úÖ {file}: Existe")
        else:
            print(f"  ‚ùå {file}: N√ÉO ENCONTRADO")
    
    # Verificar configura√ß√µes
    print("\n‚öôÔ∏è Configura√ß√µes:")
    try:
        import streamlit as st
        if os.path.exists('.streamlit/secrets.toml'):
            print("  ‚úÖ Secrets configurado")
        else:
            print("  ‚ùå Secrets n√£o encontrado")
    except:
        print("  ‚ùå Erro ao verificar configura√ß√µes")
    
    print(f"\nüìÖ Diagn√≥stico executado em: {datetime.now()}")

if __name__ == "__main__":
    diagnostic_check()
```

### üõ†Ô∏è Comandos √öteis

```bash
# Verificar instala√ß√£o
python -c "import streamlit; print('Streamlit OK')"

# Verificar porta
netstat -an | grep 8501

# Verificar logs
streamlit run app.py --logger.level=debug

# Limpar cache
rm -rf ~/.streamlit/cache

# Reinstalar depend√™ncias
pip uninstall -r requirements.txt -y
pip install -r requirements.txt
```

### üìû Quando Pedir Ajuda

Se os problemas persistirem, colete estas informa√ß√µes:

1. **Vers√£o do Python:** `python --version`
2. **Sistema operacional:** Windows/Mac/Linux
3. **Vers√£o do Streamlit:** `streamlit version`
4. **Mensagem de erro completa**
5. **Logs da aplica√ß√£o**
6. **Configura√ß√µes do Supabase** (sem chaves sens√≠veis)

**Contato:**
- üìß Email: admin@petcareai.com
- üêô GitHub: https://github.com/petcareai/dba-admin/issues
- üìö Documenta√ß√£o: https://docs.petcareai.com

---

## üìã Checklist de Resolu√ß√£o

- [ ] Verificar vers√£o do Python (3.9+)
- [ ] Instalar depend√™ncias (`pip install -r requirements.txt`)
- [ ] Configurar secrets.toml
- [ ] Testar conex√£o Supabase
- [ ] Executar scripts de banco
- [ ] Verificar RLS policies
- [ ] Testar login da aplica√ß√£o
- [ ] Verificar logs de erro

---

*Este guia √© atualizado constantemente. Para problemas n√£o listados, consulte a documenta√ß√£o completa ou entre em contato com o suporte.*
